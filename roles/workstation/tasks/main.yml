---
- name: Install utilities
  apt: name={{item}} state=present
  with_items:
    - emacs
    - htop
    - git
    - zsh
  become: yes
  become_user: root

- name: Get the username
  local_action: command whoami
  register: username

- name: Get the zsh path
  local_action: command which zsh
  register: zsh_path

- name: Add zsh as shell
  lineinfile: dest=/etc/shells line={{zsh_path.stdout}} state=present
  become: yes
  become_user: root

- name: Make zsh the login shell
  user: name={{username.stdout}} shell={{zsh_path.stdout}} state=present
  become: yes
  become_user: root
